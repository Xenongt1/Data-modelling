Decision 1: Fact Table Grain
Choice: Option A: One row per encounter
Justification: 
The primary business events are "Encounters". Billing, diagnoses, and procedures all revolve around the encounter. 
While we analyze diagnoses and procedures, storing them as the grain (Option B or C) would duplicate encounter-level metrics (costs, times) and make "per encounter" queries harder.
We will handle the many-to-many relationship of diagnoses/procedures via Bridge Tables.

Decision 2: Dimension Tables
We will create the following dimensions to denormalize the environment:

1. dim_date
   - date_key (PK)
   - full_date
   - year
   - month
   - month_name
   - quarter
   - day_of_week
   - is_weekend

2. dim_patient
   - patient_key (PK)
   - patient_id (Natural Key)
   - full_name
   - date_of_birth
   - gender
   - current_age (ETL calculated)
   - mrn

3. dim_provider
   - provider_key (PK)
   - provider_id (Natural Key)
   - provider_name
   - credential
   - specialty_name (Denormalized from old specialties table)
   - department_name (Denormalized from old departments table)

4. dim_department (Optional/Redundant if merged into provider, but useful if we want dept location info separate)
   - Let's Denormalize into `dim_provider` for simplicity based on the queries, OR keep separate if departments are entities. 
   - Actually, 'encounters' reference 'department_id'. A provider belongs to a department, but an encounter might happen in a department. Let's keep `dim_department` for the encounter's location.
   - department_key
   - department_id
   - department_name
   - floor
   - capacity

5. dim_encounter_type (Small lookup)
   - encounter_type_key
   - encounter_type_name

Decision 3: Pre-Aggregated Metrics
We will add these to `fact_encounters` to speed up common queries:
1. `total_claim_amount` (from billing)
2. `total_allowed_amount` (from billing)
3. `diagnosis_count` (count of associated diagnoses)
4. `procedure_count` (count of associated procedures)
5. `is_readmission` (Flag calculated during ETL: 1 if readmission within 30 days, 0 otherwise). This solves Q3 instantly.

Justification:
- Billing sums avoid joining the `billing` table for revenue queries.
- Counts avoid joining bridge tables just to check "how many".
- `is_readmission` pre-calculation moves the complex self-join logic to the ETL process, making the readmission query O(N) scan instead of O(N^2) join.

Decision 4: Bridge Tables
Yes, we will use bridge tables.
- `bridge_encounter_diagnoses`: (encounter_key, diagnosis_key, sequence)
- `bridge_encounter_procedures`: (encounter_key, procedure_key, date)
- We also need `dim_diagnosis` and `dim_procedure` dimensions.

Why: 
A purely denormalized flat table can't handle variable numbers of diagnoses (1 to N) without ugly columns (diag1, diag2...) or row explosion (changing grain). Bridge tables are the standard dimensional modeling solution for Multi-Valued Dimensions.
