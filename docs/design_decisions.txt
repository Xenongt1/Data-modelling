Decision 1: Fact Table Grain
Choice: Option A: One row per encounter
Justification:
Most of our analytical queries (Q1, Q3, Q4) are centered around the 'Encounter' as the fundamental unit of activity (Counts, Readmissions, Revenue).
- Option B (Diagnosis Grain) would duplicate revenue and encounter details, making sum/count queries harder (requiring distinct/averaging).
- Option C (Procedure Grain) suffers the same issue.
Option A is the cleanest for standard reporting. We will handle the "Many" relationships (Diagnoses/Procedures) using Bridge Tables (or multi-valued dimension tables).

Decision 2: Dimension Tables
We will create the following dimensions:
1. dim_date
   - date_key (PK, YYYYMMDD)
   - full_date
   - year, month, day, quarter, day_of_week
2. dim_patient
   - patient_key (PK)
   - patient_id (Natural Key)
   - name, current_age, gender
   - current_address (if we had it)
3. dim_provider
   - provider_key (PK)
   - provider_id (Natural Key)
   - full_name
   - specialty_name (Denormalized from specialties table)
   - department_name (Denormalized from departments table)
4. dim_encounter_type
   - encounter_type_key (PK)
   - encounter_type_name
5. dim_diagnosis (For Bridge)
   - diagnosis_key (PK)
   - icd10_code, description
6. dim_procedure (For Bridge)
   - procedure_key (PK)
   - cpt_code, description

Decision 3: Pre-Aggregated Metrics
In `fact_encounters`, we will store:
1. `total_claim_amount` & `total_allowed_amount`: To avoid joining the `billing` table for every revenue query. (Solves Q4 bottleneck).
2. `count_diagnoses` & `count_procedures`: Simple integers allowing us to filter for "complex" cases without joining bridge tables.
3. `length_of_stay_days`: Pre-calculated difference between discharge and admit date (Solving calculation overhead).
4. `is_readmission_flag`: (Advanced) We could compute this during ETL, but strictly it depends on the window. We'll stick to calculating it or flagging "prev_discharge_date" to make the self-join cheaper. Let's start with just the revenue/counts as definite wins.

Decision 4: Bridge Tables
Yes, we will use Bridge Tables.
Why: A patient can have multiple diagnoses and procedures per encounter.
- `bridge_encounter_diagnoses` (encounter_key, diagnosis_key, sequence)
- `bridge_encounter_procedures` (encounter_key, procedure_key, date_key)
This avoids the "Row Explosion" in the main fact table seen in Query 2, while still allowing accurate "Weighted" analysis if needed, or simple "Group Bridge" queries.
