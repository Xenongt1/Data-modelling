QUESTION 1: Monthly Encounters by Specialty

Original SQL (OLTP):
SELECT 
    DATE_FORMAT(e.encounter_date, '%Y-%m') AS month,
    s.specialty_name, ...
FROM encounters e
JOIN providers p ...
JOIN specialties s ...

Star Schema SQL:
SELECT 
    d.year, d.month,
    p.specialty_name,
    et.encounter_type_name,
    COUNT(*) AS total_encounters,
    COUNT(DISTINCT f.patient_key) AS unique_patients
FROM fact_encounters f
JOIN dim_date d ON f.date_key = d.date_key
JOIN dim_provider p ON f.provider_key = p.provider_key
JOIN dim_encounter_type et ON f.encounter_type_key = et.encounter_type_key
GROUP BY 1, 2, 3, 4;

Performance Comparison:
- Original Time: ~0.0022s
- Optimized Time: ~0.0022s
- Improvement: Similar on small data.
- Explanation: The join depth is similar (Fact -> Dim vs Table -> Table), but Star Schema avoids Date functions in GROUP BY (using date_key/month columns) and Specialty is denormalized into Dim_Provider, removing one join.

---------------------------------------------------

QUESTION 2: Top Diagnosis-Procedure Pairs

Original SQL (OLTP):
... JOIN encounters ... JOIN encounter_diagnoses ... JOIN diagnoses ... JOIN encounter_procedures ... JOIN procedures ...

Star Schema SQL:
SELECT 
    diag.icd10_code, 
    proc.cpt_code, 
    COUNT(*) AS encounter_count
FROM fact_encounters f
JOIN bridge_encounter_diagnoses bd ON f.fact_encounter_id = bd.fact_encounter_id
JOIN dim_diagnosis diag ON bd.diagnosis_key = diag.diagnosis_key
JOIN bridge_encounter_procedures bp ON f.fact_encounter_id = bp.fact_encounter_id
JOIN dim_procedure proc ON bp.procedure_key = proc.procedure_key
GROUP BY 1, 2
ORDER BY 3 DESC LIMIT 10;

Performance Comparison:
- Original Time: ~0.0015s
- Optimized Time: ~0.0015s
- Improvement: Neutral.
- Explanation: Both require bridging many-to-many relationships. The Star Schema uses integer surrogate keys which are faster to join than potentially larger natural keys, but the structural complexity of M:N relationships remains.

---------------------------------------------------

QUESTION 3: 30-Day Readmission Rate

Original SQL (OLTP):
... LEFT JOIN encounters e2 ON ... AND e2.encounter_date ... (Self Join)

Star Schema SQL:
SELECT 
    p.specialty_name, ...
    SUM(f.is_readmission) AS readmissions, ...
FROM fact_encounters f
JOIN dim_provider p ...
GROUP BY 1;

Performance Comparison:
- Original Time: ~0.0013s
- Optimized Time: ~0.0005s
- Improvement: ~2.6x Faster
- Explanation: HUGE WIN. We replaced a complex O(N^2) self-join with a simple SUM() of a pre-calculated flag `is_readmission`. The heavy lifting was done during ETL.

---------------------------------------------------

QUESTION 4: Revenue by Specialty & Month

Original SQL (OLTP):
... JOIN billing ... (Sum allowed_amount)

Star Schema SQL:
SELECT 
    ... SUM(f.total_allowed_amount) ...
FROM fact_encounters f
JOIN dim_date d ... JOIN dim_provider p ...
GROUP BY 1, 2;

Performance Comparison:
- Original Time: ~0.0005s
- Optimized Time: ~0.0003s
- Improvement: ~1.6x Faster
- Explanation: We eliminated the join to the `billing` table entirely by pre-aggregating `total_allowed_amount` into the main `fact_encounters` table. Fewer joins = faster query.
